{% extends 'templates/base.html' %}

{% block title %}{{ hostname }}{% endblock %}

{% block head %}
    <style media="screen" type="text/css">
      #details {
        display: none;
      }
      .msg {
        background-color: #F7F7F7;
        border-left: 5px solid #C0C0C0;
      }
      code {
        margin-left: 0.1em;
        margin-right: 0.1em;
        letter-spacing: 0.05em;
        color: #800080;
      }
      a code {
        color: #FFFFFF;
      }
    </style>
    <script type="text/javascript">
      $(document).ready(function(){
        $('#help').click(function(){
          $("#details").toggle();
        });
      });
    </script>
{% endblock %}

{% block container %}
      <div>
        <h2>{{ hostname }}</h2>
        <p>Welcome to your container powered webserver!</p>
      </div>
{% if hostsoutdated %}
      <div class="msg">
        <strong>Your <code>/etc/hosts</code> file is outdated, run <code>www/update-etc-hosts</code>!</strong>
      </div>
{% endif %}
      <div id="sites">
        <p>
{% for vhost in vhosts %}{% if vhost.tool %}
          <a class="btn smooth btn-a" href="http://{{ vhost.domain }}/" target="_blank">{{ vhost.name }}</a>&nbsp;
{% else %}
          <a class="btn smooth" href="http://{{ vhost.domain }}/" target="_blank">{{ vhost.name }}</a>&nbsp;
{% endif %}{% endfor %}
        </p>
        <p>
          <a id="help" class="btn smooth btn-b btn-sm" href="#"><b>help</b></a>
          <a class="btn smooth btn-a btn-sm" href="/php" target="_blank">PHP info</a>
{% for logfile in logfiles %}
          <a class="btn smooth btn-a btn-sm" href="/{{ logfile.name }}" target="_blank"><code>{{ logfile.name }}</code></a>
{% endfor %}
        </p>
      </div>
      <div id="details">
        <div>
          <h3>How it works</h3>
          <p>
            Projects placed in the <code>www/</code> directory are automatically set up as virtual hosts with their own domain names. For instance, a directory <code>mysite</code> can be reached via <code>http://mysite.loc/</code> after you configured its <code>/etc/hosts</code> record. You can <i>easily</i> update your hosts file with the <code>www/update-etc-hosts</code> script:
          </p>
          <div class="msg">
            <pre>$ cd www/
$ ./update-etc-hosts
[sudo] password for {{ lxc.user }}:
Successfully replaced the old hosts in /etc/hosts!

# update-etc-hosts - DO NOT TOUCH THIS SECTION! #############
{{ lxc.ipv4_address }} adminer.loc opcode-cache.loc
# /update-etc-hosts #########################################</pre>
          </div>
          <p>
            But if that isn't your thing, you can use these auto-generated lines:
          </p>
          <div class="msg">
            <pre>
{% for vhost in vhosts %}
{{ lxc.ipv4_address }}        {{ vhost.domain }}
{% endfor %}
            </pre>
          </div>
        </div>
        <div>
          <h4>Different projects directory?</h4>
          <p>Instead of the <code>www/</code> directory, you can mount your own projects directory as long as your user owns the files and <code>www/default</code> remains. This is achieved by changing the <code>config.ini</code> file of your container to mount your projects directory as <code>/var/www</code> in the container, a <code>halt -p</code> and restart of your container is sufficient.</p>
          <pre>/path/to/my/projects/on/host = /var/www</pre>
          <p>Even <i>easier</i>, you can make symbolic links from within <code>www/</code> to your real code checkouts. Both Apache as this script will see them as real sites and everything will remain to work, plus, it makes it more flexible to swap codebases.</p>
        </div>
      </div>
{% endblock %}
